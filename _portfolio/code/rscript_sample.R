#generate some data

var$sex<-c("females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total", "females", "males", "total")
var$year<- c(2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2016, 2016, 2016, 2016, 2016, 2016, 2016, 2016, 2016, 2016, 2016, 2016, 2016, 2016, 2016, 2016, 2016, 2016, 2016, 2016, 2016, 2016, 2016, 2016, 2016, 2016, 2016, 2016, 2016, 2016, 2016, 2016, 2016, 2016, 2016, 2016, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021)
var$month<- c(1, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 5, 5, 5, 6, 6, 6, 7, 7, 7, 8, 8, 8, 9, 9, 9, 10, 10, 10, 11, 11, 11, 12, 12, 12, 1, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 5, 5, 5, 6, 6, 6, 7, 7, 7, 8, 8, 8, 9, 9, 9, 10, 10, 10, 11, 11, 11, 12, 12, 12, 1, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 5, 5, 5, 6, 6, 6, 7, 7, 7, 8, 8, 8, 9, 9, 9, 10, 10, 10, 11, 11, 11, 12, 12, 12, 1, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 5, 5, 5, 6, 6, 6, 7, 7, 7, 8, 8, 8, 9, 9, 9, 10, 10, 10, 11, 11, 11, 12, 12, 12, 1, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 5, 5, 5, 6, 6, 6, 7, 7, 7, 8, 8, 8, 9, 9, 9, 10, 10, 10, 11, 11, 11, 12, 12, 12, 1, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 5, 5, 5, 6, 6, 6, 7, 7, 7, 8, 8, 8, 9, 9, 9, 10, 10, 10, 11, 11, 11, 12, 12, 12, 1, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 5, 5, 5, 6, 6, 6, 7, 7, 7, 8, 8, 8, 9, 9, 9, 10, 10, 10, 11, 11, 11, 12, 12, 12)
var$age.grp<- c(-10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10)
var$rate.all_liv<- c(5.63013442759379, 8.47187980791126, 6.89053012947773, 5.56667797282817, 9.64085436347387, 7.39575157008843, 5.18256594157621, 8.8988740250507, 6.90185693757331, 5.55044809868253, 9.78368349072138, 7.30480841110974, 6.08182802773029, 8.47704068284617, 7.16320085085886, 4.99576793919529, 6.9397744303216, 5.80990024602898, 4.93318661864715, 8.48316518855626, 6.52145286600879, 4.62102312800755, 9.5619329613782, 6.82236254470851, 4.64102948016743, 9.32157880443989, 6.67237600040787, 4.09078352211285, 9.40511609969171, 6.43367620966386, 4.32667604079853, 7.84931440150849, 5.87272294204214, 4.94684833234698, 9.77238184969379, 7.06457342522239, 4.70667840834258, 8.8930781350752, 6.60911850225524, 4.83278985325467, 9.60668214779268, 7.00501631346434, 5.57445571230158, 10.0205096296281, 7.55588200503793, 4.4307166325235, 8.99452272931584, 6.37514354576547, 5.04224622240304, 10.9362054596993, 7.55517831538713, 4.86163345080531, 7.58871236619198, 6.07509502075916, 4.61588988083268, 9.46425479582917, 6.6546709101219, 5.59551917703883, 9.24587438767428, 7.18166951261456, 4.74596091924704, 9.46253754127755, 6.87583960473679, 5.2014802431094, 10.4358731407592, 7.37168608991995, 5.10098475094311, 8.70209850281098, 6.77085353630912, 4.82914000044831, 7.73114152589645, 6.10622122150451, 4.8757011436924, 10.5244600169262, 7.21665453174875, 4.58182121407833, 8.22868664061279, 6.24465911451495, 4.6970861469085, 7.34595442800807, 5.76314282604443, 3.49062878107271, 8.02652699717882, 5.47406648446341, 4.45066340384761, 7.89743540253608, 6.08171438741994, 4.57178401841259, 7.90117408161982, 5.9656335355037, 5.08479374055103, 8.0594636732467, 6.28389272738206, 4.1214496620298, 7.52518565857737, 5.65619901737603, 3.90874026881213, 7.87999325163889, 5.57158180066382, 4.79248495433538, 7.79124013995885, 6.10510931137668, 4.72065677377871, 8.2604399261326, 6.26242109305839, 4.91824025330428, 9.20429754329401, 6.74073135289816, 4.40831231747298, 9.05479578522512, 6.5627488641459, 5.01958789386229, 8.17910689374117, 6.38976937219786, 5.01211541703808, 8.52392317412584, 6.60929975725569, 4.80262306724476, 7.71021980628011, 6.18853611507665, 4.06205528184645, 7.17441923313483, 5.35493679457841, 4.26251580511175, 8.30913088623651, 6.061339722005, 4.90342078040245, 6.5781406019155, 5.65102299835955, 4.17436112854289, 7.37763702401902, 5.66727571020543, 4.19925190433003, 7.06557513588323, 5.54586901499836, 5.30441523879659, 7.95277960366894, 6.53316890419006, 3.8981230043846, 6.41724880837433, 4.98361319666663, 4.9615345587049, 7.38046201834833, 6.00431753242657, 4.8280046297327, 7.58098078930222, 6.16141547799356, 4.6106019668511, 6.59668522245852, 5.45455765519571, 4.450014524408, 8.01215835220954, 5.89344622875184, 4.57988002765006, 6.77360128766858, 5.63742587576233, 4.55230227217558, 8.95404274548527, 6.45727857414171, 4.0409768322008, 7.09921233714582, 5.47118837468684, 5.15007150411159, 7.66173142521365, 6.16416402348431, 4.52579952003136, 7.21885786265875, 5.70666230657561, 5.25972340220538, 7.59970042803664, 6.29295528313328, 4.67731651822472, 8.72712193653816, 6.54761490025542, 4.6046775643702, 8.25926688577964, 6.1948992807529, 4.55229144829721, 8.17049030407518, 6.2415749971133, 5.84139501687572, 9.65677230371028, 7.42190742751816, 4.02454792400268, 8.61365279368118, 6.16103622309574, 4.73782035711733, 8.69320711237516, 6.58571721094761, 4.29132118336234, 8.01137672250558, 5.84462121260738, 5.20642076459701, 7.7905816476967, 6.4987630717199, 4.89195583514707, 7.46029181421404, 5.99096785096438, 5.13671261528101, 8.08701899153039, 6.57809930736312, 5.09285865567825, 10.9593174395414, 7.81850489718968, 5.35872858055291, 7.08929364362143, 6.13818123206664, 5.25663361577936, 10.3617025140155, 7.62040203832379, 5.40708302786574, 9.85442026058894, 7.41484631107039, 5.95691314067752, 9.0799961925712, 7.48120929994941, 5.91825428226853, 8.71586746129182, 7.29745971326589, 5.4826590609739, 8.81237777493038, 7.04829081281767, 5.52396932815517, 10.2976201989228, 7.68678973320564, 5.49594164232245, 8.86164465051169, 6.88583121820592, 4.97305375379784, 8.2401356317482, 6.48145190324145, 5.17946792225785, 10.2874764676836, 7.54886537531741, 4.68259666948561, 10.5027235162364, 7.31923233232214, 5.64724106873524, 9.73575300309514, 7.52676118711903, 5.71764088291779, 8.59803349002938, 7.03287791907073, 7.01829266477433, 9.27020415872928, 8.16211242485738, 4.66611918100271, 7.21101332083146, 5.82940202777271, 5.38069830084399, 8.69570473307235, 6.77824111859861)
var$rate.all_livelse<- c(3.04376969660489, 3.31846958279986, 3.21162432026065, 2.45909670217457, 3.28258156972568, 2.85060044315139, 2.55660318830603, 3.67784874772256, 3.01985726316248, 3.02017909669404, 3.92642599977669, 3.3532775541698, 3.08434264139116, 3.46516844211728, 3.36431959525455, 3.01852875747206, 3.10768929960465, 3.0735399856232, 2.97486691170847, 3.90874471528253, 3.421116863398, 2.88374139708165, 3.69765984505889, 3.24107976523232, 2.97070665732682, 3.523178157444, 3.18039146469737, 2.97957687818349, 4.15446437313711, 3.4369797499091, 2.86021935295155, 3.60587721010878, 3.17610888573334, 2.61090488636883, 3.95981344697692, 3.14710705987576, 2.88055012836189, 3.26274813537532, 3.0745867570259, 3.16857347360146, 3.44532736993408, 3.28520598481343, 2.96893258043616, 4.44706404577218, 3.60355363290583, 3.01805262187543, 3.9098810568632, 3.38530908064338, 2.82670463881945, 4.21016718060609, 3.36283491509543, 2.89293241163481, 3.59503654661573, 3.20309400593849, 2.73441294166526, 3.96050415091543, 3.25247169392398, 3.12294046818166, 3.64241698271487, 3.32746857119914, 2.89732997706958, 3.19990915401252, 3.0331775209802, 2.77212299528041, 3.83275849972935, 3.19832673409027, 3.24873862912212, 3.82728486970545, 3.54018441172773, 2.77639142580619, 3.40640296522795, 3.10955064920263, 2.79249658769335, 3.97302462770547, 3.18817981918908, 2.84560037836667, 2.75076552298753, 2.85263875619582, 2.8556878504418, 3.77785956084598, 3.19674338716304, 2.61961351863162, 2.92402827879203, 2.74439963962516, 2.83766225074563, 3.12207441518184, 3.01243217089505, 2.81726533312342, 4.01482910507885, 3.3215819181013, 2.97630867685212, 3.52388668117002, 3.2293117171157, 2.6893139578593, 3.98954009358287, 3.2289177484587, 2.72607392617017, 3.44600607365541, 3.02543129754175, 2.79724460953591, 3.18883392423606, 2.98571611253853, 3.06780347013989, 3.14542119724363, 3.11302532737314, 2.83447023288798, 3.897691092944, 3.23652157608669, 3.00254056856239, 3.52879230613981, 3.29029980612533, 2.93729988743427, 3.25223424618691, 3.13191553454102, 2.92919795459213, 3.30588143135813, 3.11332729470529, 2.9482613374461, 3.51936290525028, 3.23437241935363, 2.78049429254306, 3.68694494894621, 3.11038238471847, 2.70110119419354, 3.62535554276907, 3.11223770598625, 2.75060357416795, 3.08436716482906, 2.90028673842653, 2.83529110278441, 3.483122189807, 3.18250614062269, 2.58994870662601, 4.07496440598757, 3.22889094633865, 2.86982586745694, 3.44129862062725, 3.15478137791121, 2.88781134681612, 3.55407509013271, 3.13884174750067, 2.69300950979, 3.90325906206901, 3.19501858747988, 2.76360200978635, 3.26179744275538, 2.99683995363787, 2.83398631463229, 3.6539882045492, 3.19152801650259, 3.06639329519749, 3.5421660455122, 3.27723587601829, 3.04643219443349, 2.93726248668737, 3.10468255471116, 2.74446796118042, 4.2560270735956, 3.38244448081538, 3.02735391717479, 3.54982642486666, 3.27020378969579, 2.87339441659003, 3.7788583580568, 3.21493764633344, 2.7173422965477, 3.44331047631403, 3.07496682973149, 2.91786336634614, 3.27930223200359, 3.11320066295959, 3.01980794442413, 4.31589314147224, 3.63294798337064, 2.8000536652045, 3.33260207839382, 3.0080039381339, 3.15555348212133, 4.0821689434043, 3.53544871973649, 3.08803480441859, 4.16200976253901, 3.53665498513648, 2.90051523261017, 4.15027370332346, 3.49810666941496, 2.69752981507341, 4.14198582394393, 3.33515625885839, 2.65115292604996, 3.67415946200735, 3.12312942405372, 2.63237211497481, 3.6335570857691, 3.08077775973809, 2.87644216207274, 3.37603120073167, 3.10444105302666, 2.69807989116524, 3.41674242922162, 3.03385251703421, 2.59964100549749, 3.5408584157071, 3.02211546120396, 3.11096905553469, 2.91701112874639, 3.02606221046744, 2.76534314310656, 3.66171665189658, 3.15396314247174, 3.01058252564339, 3.75322189708292, 3.39444207586674, 3.04078104768202, 3.14508500479179, 3.13766452659511, 3.40562825607455, 3.78573082516915, 3.61804066181924, 3.19957080927991, 3.7003552351042, 3.47219056257037, 2.85660302053775, 4.32389186714063, 3.52530575307893, 2.76967195970858, 3.6010315534546, 3.10726730571526, 3.01819395057333, 3.55878660425583, 3.24826061690011, 2.88208869390471, 3.52727259502188, 3.18307785672455, 2.77241292606826, 3.8404860097817, 3.24478439807596, 3.18377600633531, 3.65506427641395, 3.41674046173926, 3.02259457202923, 3.50953432609328, 3.25139190345787, 3.31114797998608, 3.50589984517393, 3.46715586181097, 2.93312198944451, 3.37547891748359, 3.13917858083521, 3.05675033619568, 3.34500604010271, 3.16265627350442)
var$time<-paste0(var$year,"/",var$month,"/","1")
var$time<-as.Date(var$time)

var$covid<-0
var[year>2020]$covid<-1
var[year==2020&month>3]$covid<-1


#make data.table object
var<-data.table(var)

#transpose to long format to plot lines as colours 
longform<-var%>%pivot_longer(cols = c(5:6), names_to ="outcome", values_to = "val" )

#ggplot
ggplot() + 
  geom_line(data = longform, aes(x = time, y = val, group = outcome,colour = outcome), linetype = 1,    size = 1)+
  facet_wrap(~sex, scales = "free", ncol=1)+
  scale_color_manual(name = "Liver outcomes", values = c("rate.all_liv" = "magenta", "rate.all_livelse" = "blue"), labels = c("rate.all_liv" = "All liver conditions", "rate.all_livelse" = "Other liver conditions"))+
  scale_y_continuous(name = "Mortality Rate (per 100,000)")+
  theme_bw(base_size= 16) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.text.x = element_text(angle = 45, vjust=0.7), plot.title = element_text(face = "bold", hjust = 0.5))+
  ggtitle("Liver Cirrhosis Mortality Rate \n (15+ years by outcome)")

#check for normality
hist(var[sex=="total"]$rate.all_liv)

#log transform if non-normal
hist(log(var[sex=="total"]$rate.all_liv))

model<-lm(log(rate.all_liv)~covid, data = var[sex=="total"])

summary(model)
